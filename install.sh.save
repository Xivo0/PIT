#!/bin/bash

# --- Script d'Installation du Roguelike ---

echo "########################################"
echo "# Bienvenue dans BASH QUEST: Le Donjon #"
echo "########################################"
echo
echo "Création de votre destinée..."

# 1. Création de l'arborescence
mkdir -p DONJON/stats
mkdir -p DONJON/etages/etage1/entree

echo "Donjon créé."

# 2. Choix de la classe
echo "Choisissez votre classe :"
echo "  [1] Guerrier (Robuste, frappe fort)"
echo "  [2] Mage     (Fragile, mais utilise la magie)"
echo "  [3] Voleur   (Équilibré, trouve plus d'objets)"
echo

read -p "Votre choix [1-3]: " choix_classe

# 3. Écriture des stats de base
# On utilise 'stats_dir' pour simplifier le chemin
stats_dir="DONJON/stats"

case $choix_classe in
  1) # Guerrier
    echo "Guerrier" > "$stats_dir/classe"
    echo "20" > "$stats_dir/hp_max"
    echo "20" > "$stats_dir/hp_current"
    echo "5" > "$stats_dir/pe_max"      # Peu de 'mana'
    echo "5" > "$stats_dir/pe_current"
    echo "5" > "$stats_dir/attaque_base" # Grosse attaque
    echo "0" > "$stats_dir/magie_base"
    echo "1" > "$stats_dir/chance_loot" # Chance normale
    ;;
  2) # Mage
    echo "Mage" > "$stats_dir/classe"
    echo "12" > "$stats_dir/hp_max"
    echo "12" > "$stats_dir/hp_current"
    echo "15" > "$stats_dir/pe_max"      # Beaucoup de 'mana'
    echo "15" > "$stats_dir/pe_current"
    echo "2" > "$stats_dir/attaque_base" # Faible attaque
    echo "6" > "$stats_dir/magie_base"   # Grosse magie
    echo "1" > "$stats_dir/chance_loot"
    echo "sort_feu" > "$stats_dir/grimoire.txt" # Le mage commence avec un sort
    ;;
  3) # Voleur
    echo "Voleur" > "$stats_dir/classe"
    echo "15" > "$stats_dir/hp_max"
    echo "15" > "$stats_dir/hp_current"
    echo "10" > "$stats_dir/pe_max"
    echo "10" > "$stats_dir/pe_current"
    echo "3" > "$stats_dir/attaque_base"
    echo "3" > "$stats_dir/magie_base"
    echo "3" > "$stats_dir/chance_loot" # Plus de chance de loot !
    echo "potion_soin" > "$stats_dir/inventaire.txt" # Commence avec une potion
    ;;
  *) # Défaut (si l'utilisateur tape n'importe quoi)
    echo "Choix invalide. Vous serez un... Paysan."
    echo "Paysan" > "$stats_dir/classe"
    echo "10" > "$stats_dir/hp_max"
    echo "10" > "$stats_dir/hp_current"
    echo "5" > "$stats_dir/pe_max"
    echo "5" > "$stats_dir/pe_current"
    echo "1" > "$stats_dir/attaque_base"
    echo "0" > "$stats_dir/magie_base"
    echo "1" > "$stats_dir/chance_loot"
    ;;
esac

# 4. Création des fichiers d'inventaire (vides au besoin)
touch "$stats_dir/inventaire.txt"
touch "$stats_dir/grimoire.txt"

# 5. Création de la première salle (l'entrée)
echo "Création de l'étage 1..."

# Le chemin vers la salle d'entrée
salle_entree="DONJON/etages/etage1/entree"

# On écrit le message de bienvenue (avec un Here Document)
cat << EOF > "$salle_entree/message.txt"
Bienvenue dans le donjon.

Vous pouvez voir vos points de vie à tout moment avec la commande : statut

Devant vous se tient votre premier adversaire.
Pour l'inspecter, utilisez la commande : regarder <nom_de_l_ennemi>

Pour l'attaquer, utilisez la commande : attaquer <nom_de_l_ennemi>
EOF

# On place le premier ennemi (8 PV)
echo "8" > "$salle_entree/rat_chetif"

echo "Personnage créé."

# 6. Instructions de départ
echo
echo "###################################################################"
echo "Votre aventure commence."
echo "Pour entrer dans le donjon, vous devez d'abord charger les commandes du jeu."
echo
echo "Tapez la commande suivante pour commencer :"
echo
echo "  export PATH=\$(pwd)/DONJON/scripts:\$PATH && cd DONJON/etages/etage1/entree"
echo
echo "######################################################"
